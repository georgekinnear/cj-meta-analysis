---
title: "RQ1 plots"
author: "Ian Jones"
date: "Feb 2023"
output:
  html_document:
    df_print: paged
---

## Setup

```{r setup, include=TRUE, attr.output='.numberLines'}
knitr::opts_chunk$set(echo = TRUE,
                      dev.args = list(png = list(type = "cairo")))
library(ggplot2)     # required to make plots
library(dplyr)       # for data wrangling/hygiene
library(viridis)     # viridis colour palettes
library(colorspace)  # colorspace colour palettes
library(ggExtra)     # to add marginal density plots & histograms
library(gghalves)    # required to make raincloud plots
library(gridExtra)   #put plots side by side
library(readr)
library(gghalves)
library(tidyverse)

# create subdirectory to store figures if it doesn't exist
#mainDir = setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
#dir.create(file.path(mainDir, "figs"))

```

## Raincloud plots for RQ1 CJ META-ANALYSIS: Counts

```{r scatter, include=TRUE, attr.output='.numberLines', eval = TRUE, echo = TRUE}


rq1 <- read.csv("data/00-RQ1_table_fewercolumns.csv")
#get rid of summary stats rows
rq1 <- rq1[1:101,]
#get counts (ass, rep, comp) data
counts <- rq1[,c(1,3:5)]
counts <- pivot_longer(counts, cols = 2:4)
colnames(counts)[2] <- "key"

#choose order of x axis categories
counts$key <- factor(counts$key, levels=c('Rep', 'Comp', 'Ass'))


# Raincloud plot with repeated measurements
plotCounts <- counts %>%                 # define dataframe
  ggplot(aes(x = key,       # define x var
             y = value)) + # define y var
  
  #Add individual observations to the plot
  geom_point(
    position = position_jitter(width=.1), # add jitter to the observations
    size=.5, alpha=.4, # set the size of each dot. alpha adds transparency
    color = "black", fill = "black") + 
  
  
  #y tick labels
  scale_y_continuous(trans='log10', labels = scales::comma) +
  
  geom_text(x = 3.3, y = 3, label = "Assessors") +
  geom_text(x = 2.3, y = 3, label = "Comparisons") +
  geom_text(x = 1.3, y = 3, label = "Representations") +
  
  # Optional styling
  coord_flip() +                          # flip x & y coordinates
  xlab(NULL) +        # x-axis label
  ylab(NULL) + # y-axis label
  theme(            # make modifications to the theme
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    aspect.ratio = 1,
    panel.grid.major.y=element_blank(),   # hide major grid for y axis
    panel.grid.minor.y=element_blank(),   # hide minor grid for y axis
    panel.grid.major.x=element_line(),    # show major grid for x axis
    panel.grid.minor.x=element_blank(),   # hide minor grid for x axis
    legend.position="none")


plotCounts

ggsave("figs-pdf/FIG-RQ1_counts_raincloud.pdf", units = "cm", width = 20, height = 14)

```

## Scatterplots for RQ1:  Assessors vs Comparisons

```{r scatter, include=TRUE, attr.output='.numberLines', eval = TRUE, echo = TRUE}
rq1 %>% 
  ggplot(aes(x = Ass, y = Comp)) +
  scale_y_continuous(trans='log10', labels = scales::comma) +
  scale_x_continuous(trans='log10', labels = scales::comma) +
#  geom_vline(xintercept = 0.7, alpha = 0.3, colour = "#CC0000") +
#  geom_hline(yintercept = 0.7, alpha = 0.3, colour = "#CC0000") +
#  geom_abline(slope = 1, intercept = 0, alpha = 0.5) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm", formula = "y ~ x", colour = "#003399", se = FALSE) +
  ggpubr::stat_cor(p.accuracy = 0.001) +
  theme(aspect.ratio = 1) +
#  xlim(c(0,1)) +
#  ylim(c(0,1)) +
  labs(x = "Assessors", y = "Comparisons")
ggsave("figs-pdf/FIG-RQ1_assVScomp.pdf", units = "cm", width = 14, height = 14)
```
## Scatterplots for RQ1:  Assessors vs Representations

```{r scatter, include=TRUE, attr.output='.numberLines', eval = TRUE, echo = TRUE}
rq1 %>% 
  ggplot(aes(x = Ass, y = Rep)) +
  scale_y_continuous(trans='log10', labels = scales::comma) +
  scale_x_continuous(trans='log10', labels = scales::comma) +
#  geom_vline(xintercept = 0.7, alpha = 0.3, colour = "#CC0000") +
#  geom_hline(yintercept = 0.7, alpha = 0.3, colour = "#CC0000") +
#  geom_abline(slope = 1, intercept = 0, alpha = 0.5) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm", formula = "y ~ x", colour = "#003399", se = FALSE) +
  ggpubr::stat_cor(p.accuracy = 0.001) +
  theme(aspect.ratio = 1) +
#  xlim(c(0,1)) +
#  ylim(c(0,1)) +
  labs(x = "Assessors", y = "Representations")
ggsave("figs-pdf/FIG-RQ1_assVSrep.pdf", units = "cm", width = 14, height = 14)
```
## Scatterplots for RQ1:  Comparisons vs Representations

```{r scatter, include=TRUE, attr.output='.numberLines', eval = TRUE, echo = TRUE}
rq1 %>% 
  ggplot(aes(x = Comp, y = Rep)) +
  scale_y_continuous(trans='log10', labels = scales::comma) +
  scale_x_continuous(trans='log10', labels = scales::comma) +
#  geom_vline(xintercept = 0.7, alpha = 0.3, colour = "#CC0000") +
 # geom_hline(yintercept = 0.7, alpha = 0.3, colour = "#CC0000") +
#  geom_abline(slope = 1, intercept = 0, alpha = 0.5) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm", formula = "y ~ x", colour = "#003399", se = FALSE) +
  ggpubr::stat_cor(p.accuracy = 0.001) +
  theme(aspect.ratio = 1) +
#  xlim(c(0,1)) +
#  ylim(c(0,1)) +
  labs(x = "Comparisons", y = "Representations")
ggsave("figs-pdf/FIG-RQ1_compVSrep.pdf", units = "cm", width = 14, height = 14)
```

## Raincloud plot for RQ1 CJ META-ANALYSIS: Derived Counts

```{r scatter, include=TRUE, attr.output='.numberLines', eval = TRUE, echo = TRUE}
library("readr")
library("gghalves")


#get counts (ass, rep, comp) data
#counts2 <- rq1[,9:11]
#counts2 <- gather(counts2)
counts2 <- rq1[,c(1,9:11)]
counts2 <- pivot_longer(counts2, cols = 2:4)
colnames(counts2)[2] <- "key"



# Raincloud plot with repeated measurements
plotCounts2 <- counts2 %>%                 # define dataframe
  ggplot(aes(x = key,       # define x var
             y = value)) + # define y var
  
  #Add individual observations to the plot
  geom_point(
    position = position_jitter(width=.1), # add jitter to the observations
    size=.5, alpha=.4, # set the size of each dot. alpha adds transparency
    color = "black", fill = "black") + 
  
 
  #y tick labels
  scale_y_continuous(trans='log10', labels = scales::comma) +
  
    
  geom_text(x = 3.3, y = 1, label = "Representations per assessor") +
  geom_text(x = 2.3, y = 1, label = "Comparisons per representation") +
  geom_text(x = 1.3, y = 1, label = "Comparisons per assessor") +
  
  # Optional styling
  coord_flip() +                          # flip x & y coordinates
  xlab(NULL) +        # x-axis label
  ylab(NULL) + # y-axis label
  theme(            # make modifications to the theme
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    aspect.ratio = 1,
    panel.grid.major.y=element_blank(),   # hide major grid for y axis
    panel.grid.minor.y=element_blank(),   # hide minor grid for y axis
    panel.grid.major.x=element_line(),    # show major grid for x axis
    panel.grid.minor.x=element_line(),   # show minor grid for x axis
    legend.position="none")


plotCounts2
ggsave("figs-pdf/FIG-RQ1_derived_counts_raincloud.pdf", units = "cm", width = 14, height = 14)
```
## Scatterplots for RQ1:  Representations per assessor vs Comparisons per representation

```{r scatter, include=TRUE, attr.output='.numberLines', eval = TRUE, echo = TRUE}
rq1 %>% 
  ggplot(aes(x = repPERass, y = CompPERrep)) +
  scale_y_continuous(trans='log10', labels = scales::comma) +
  scale_x_continuous(trans='log10', labels = scales::comma) +
  #geom_vline(xintercept = 0.007, alpha = 0.3, colour = "#CC0000") +
  #geom_hline(yintercept = 0.007, alpha = 0.3, colour = "#CC0000") +
 # geom_abline(slope = -1, intercept = 0, alpha = 0.5) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm", formula = "y ~ x", colour = "#003399", se = FALSE) +
  ggpubr::stat_cor(p.accuracy = 0.001) +
  theme(aspect.ratio = 1) +
#  xlim(c(0,1)) +
#  ylim(c(0,1)) +
  labs(x = "Representations per assessor", y = "Comparisons per representation")
ggsave("figs-pdf/FIG-RQ1_repPERassVSCompPERrep.pdf", units = "cm", width = 14, height = 14)
```
## Scatterplots for RQ1: Representations per assessor vs Comparisons per assessor

```{r scatter, include=TRUE, attr.output='.numberLines', eval = TRUE, echo = TRUE}
rq1 %>% 
  ggplot(aes(x = repPERass, y = CompPERass)) +
  scale_y_continuous(trans='log10', labels = scales::comma) +
  scale_x_continuous(trans='log10', labels = scales::comma) +
 # geom_vline(xintercept = 0.007, alpha = 0.3, colour = "#CC0000") +
 # geom_hline(yintercept = 0.007, alpha = 0.3, colour = "#CC0000") +
 # geom_abline(slope = 1, intercept = 0, alpha = 0.5) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm", formula = "y ~ x", colour = "#003399", se = FALSE) +
  ggpubr::stat_cor(p.accuracy = 0.001) +
  theme(aspect.ratio = 1) +
#  xlim(c(0,1)) +
#  ylim(c(0,1)) +
  labs(x = "Representations per assessor", y = "Comparisons per assessor")
ggsave("figs-pdf/FIG-RQ1_repPERassVSCompPERass.pdf", units = "cm", width = 14, height = 14)

```
## Scatterplots for RQ1: Comparisons per representation vs Comparisons per assessor

```{r scatter, include=TRUE, attr.output='.numberLines', eval = TRUE, echo = TRUE}
rq1 %>% 
  ggplot(aes(x = CompPERrep, y = CompPERass)) +
  scale_y_continuous(trans='log10', labels = scales::comma) +
  scale_x_continuous(trans='log10', labels = scales::comma) +
#  geom_vline(xintercept = 0.7, alpha = 0.3, colour = "#CC0000") +
#  geom_hline(yintercept = 0.7, alpha = 0.3, colour = "#CC0000") +
#  geom_abline(slope = 1, intercept = 0, alpha = 0.5) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm", formula = "y ~ x", colour = "#003399", se = FALSE) +
  ggpubr::stat_cor(p.accuracy = 0.001) +
  theme(aspect.ratio = 1) +
#  xlim(c(0,1)) +
#  ylim(c(0,1)) +
  labs(x = "Comparisons per representation", y = "Comparisons per assessor")
ggsave("figs-pdf/FIG-RQ1_CompPERassVSCompPERrep.pdf", units = "cm", width = 14, height = 14)

```
